-- ============================================================================
-- 데이터 추출 쿼리 템플릿
-- ============================================================================
-- 목적: MySQL에 적재된 원본 데이터에서 필요한 부분만 추출하여 CSV로 저장
-- 사용법: 이 파일을 수정한 뒤 export_mysql.ps1로 실행
--
-- 실행 명령어:
-- ./scripts/export_mysql.ps1 -QueryFile "scripts/sql/extract_mysql.sql" -OutputCsv "data/processed/결과파일.csv"
-- ============================================================================

-- ----------------------------------------------------------------------------
-- [현재 예시] raw_data(이벤트 상세) + match_info(경기 정보) 조인
-- ----------------------------------------------------------------------------
-- raw_data: 각 경기의 모든 플레이 이벤트 (패스, 슛, 태클 등)
-- match_info: 경기 메타 정보 (날짜, 팀명, 스코어 등)
-- ----------------------------------------------------------------------------

SELECT 
  -- raw_data의 모든 컬럼 (game_id, action_id, period_id, time_seconds, type_name 등)
  r.*,
  
  -- match_info에서 추가로 가져올 컬럼들 (분석에 필요한 경기 메타데이터)
  m.season_name,           -- 시즌 (예: '2024')
  m.competition_name,      -- 대회명 (예: 'K League 1')
  m.game_date,             -- 경기 날짜
  m.home_team_name_ko,     -- 홈팀 한글명
  m.away_team_name_ko,     -- 원정팀 한글명
  m.home_score,            -- 홈팀 득점
  m.away_score             -- 원정팀 득점

FROM raw_data r
LEFT JOIN match_info m ON r.game_id = m.game_id
  -- LEFT JOIN: raw_data의 모든 행을 유지하면서 match_info를 붙임
  -- game_id로 연결: 같은 경기의 이벤트들이 동일한 경기 정보를 가짐

WHERE 1=1
  -- ----------------------------------------------------------------------------
  -- [필터 옵션] 아래 주석을 풀고 수정해서 필요한 데이터만 필터링하세요
  -- ----------------------------------------------------------------------------
  
  -- 예시 1) 특정 시즌만 (2024 시즌)
  -- AND m.season_name = '2024'
  
  -- 예시 2) 특정 팀의 데이터만 (울산 HD FC)
  -- AND r.team_name_ko = '울산 HD FC'
  
  -- 예시 3) 특정 이벤트 타입만 (패스와 슛만)
  -- AND r.type_name IN ('패스', '슛')
  
  -- 예시 4) 특정 날짜 범위 (3월 데이터만)
  -- AND m.game_date >= '2024-03-01' AND m.game_date < '2024-04-01'
  
  -- 예시 5) 득점 차이가 큰 경기만 (3골 이상 차이)
  -- AND ABS(m.home_score - m.away_score) >= 3
  
  -- 예시 6) 여러 조건 조합 (2024 시즌 + 울산 팀 + 패스 이벤트)
  -- AND m.season_name = '2024'
  -- AND r.team_name_ko = '울산 HD FC'
  -- AND r.type_name = '패스'

-- ----------------------------------------------------------------------------
-- [LIMIT 설정] 처음엔 작은 숫자로 테스트 후, 실제 사용 시 늘리거나 제거
-- ----------------------------------------------------------------------------
LIMIT 100000;  
-- 100000: 10만 행만 추출 (테스트용)
-- 전체 데이터가 필요하면 이 줄을 삭제하거나 LIMIT 5000000; 같이 큰 숫자로 변경
-- 참고: 전체 raw_data는 약 58만 행

-- ============================================================================
-- [팁]
-- ============================================================================
-- 1. 처음엔 LIMIT 1000 정도로 작게 테스트해서 결과 확인
-- 2. WHERE 조건으로 필요한 데이터만 뽑으면 처리 속도 빠름
-- 3. 집계(COUNT, AVG 등)가 필요하면 GROUP BY 추가 가능
-- 4. 쿼리 수정 후 Git 커밋해서 팀원들과 공유
-- ============================================================================

